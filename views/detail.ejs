<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
	<title>Band title</title>
	<link rel="stylesheet" href="./common.css"></link>
	<link rel="stylesheet" href="./NotoSansKR-Regular/styles.css"></link>
	<script type="text/javascript" src="./js/jquery-1.9.1.min.js"></script>
	<link rel="stylesheet" type="text/css" href="css/selectize.css" />
	<script type="text/javascript" src="js/selectize.js"></script>
	
	<script type="text/javascript" src="./js/sgen.js"></script>	


	<link href="css/jquery-ui.css" rel="stylesheet" />
	<link href="css/jquery.ui.theme.css" rel="stylesheet" />

	<link href="css/timelineScheduler.css" rel="stylesheet" />
	<link href="css/timelineScheduler.styling.css" rel="stylesheet" />
	<link href="css/calendar.css" rel="stylesheet" />
	
	<link href="css/home.css" rel="stylesheet" />
	
	<script src="js/moment.min.js"></script>

	<script src="js/jquery-ui-1.10.2.min.js"></script>

	<script src="js/timelineScheduler.js"></script>
	<script src="js/calendar.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"> </script>

	
	
</head>
<body style="background:#e0e0e0;">
	<div id="wrapper">
		<div id="header">
			<div id="title_line">
				<div id="title_home" class="title_btns">
					<a href="/home"> HOME </a>
				</div>
				<div id="title_mail" class="title_btns">
					<a href="/mail"> MAIL </a>
				</div>
				<div id="title_calender" class="title_btns">
					<a href="/calender"> CALENDER </a>
				</div>
				<div id="title_me" class="title_btns">
					ME
				</div>
				<div id="title_setting" class="title_btns">
					SETTING
				</div>
			</div>
		</div>

		<div id="home_container" style="text-align:center;">
			<div id="home_search">
				<div id ="home_search_form">
					<div id ="home_search_text">
						<form>
							<input id="home_search_input" type="text" placeholder="검색어를 입력하세요" size="70px" ></input>
							<input type="image" src="./images/searchBtn.png" class="search_image" ></input>
						</form>
					</div>
				</div>
			</div>

			<div id="home_noti" class="in_container"> 
				<div id="noti_form">
					<h3 id="today"> TODAY </h3>
					<p id="noti_date"> </p>
					<a href="/detail">
						<input type="image" src="./images/refresh.png"id="img_refresh" ></input></a>
					</div>
					<div id="noti_msg" class="in_noti">
						<div id="msg_text">
							<h1> 안읽은 메시지 </h1>
							<h3 id="noti_time"></h3>
						</div>
						<div id="msg_drawing">
							<div class="msg_info" id="msg_out">
								<h4> 외부메시지 </h4>
								<p class="msg_num" id="out_num"> 3 </p>
							</div>
							<div class="msg_info" id="msg_in">
								<h4> 내부메시지 </h4>
								<p class="msg_num" id="in_num"> </p>
							</div>
							<div class="msg_info" id="msg_team">
								<h4> 팀메시지 </h4>
								<p class="msg_num" id="team_num"> 3 </p>
							</div>
							<div id="msg_circle"> </div>
							<p id="msg_total_num">29 </p>
							<p id="msg_total"> total </p>
						</div>

					</div>
					<div id="noti_meeting" class="in_noti" >
						<div id="meeting_text">
							<h1> 다음 미팅 </h1>
							<div id="time_left">
								<p id="min"> 15 </p>
								<p id="min_text"> 분 후 </p>
							</div>
						</div>
						<div id="meeting_schedule">
							<div class="meeting_info">
								<p class="meeting_title"> 마게팅 미팅 </p>
								<h3 class="meeting_time"> 8월 10일 오후 3:00 </h3>
							</div>
							<div class="meeting_info">
								<p class="meeting_title"> 디자인 회의 </p>
								<h3 class="meeting_time"> 8월 12일 오전 10:00 </h3>
							</div>
							<div class="meeting_info">
								<p class="meeting_title"> 팀장 회의 </p>
								<h3 class="meeting_time"> 8월 9일 오후 4:00 </h3>
							</div>
						</div>
					</div>
				</div>

				<div id="home_around" class="in_container"> 
					<div id="around_form">
						<h2> 키워드 </h2>
						<p id="around_keyword"> 개발, 디자인, xml 외</p>
						<h3 id="around_keyword_num"> 13개 </h3>
						<a href="/home">
							<input type="image" src="./images/back_btn.png"id="detail_back" ></input></a>
						</div>
						<div id="around">
							<svg id="svg_around"></svg>
						</div>
						<div id="cw_detail"> 
							<div id="detail_form">
								<input type="image" src="./images/x_btn.png"id="detail_close" ></input>
							</div>
							<svg id="detail_svg"> </svg>
							<h2 class="detail_cw_info" id="cw_name" > name </h2>
							<p class ="detail_cw_info" id="cw_depart"> department </p>
							<p class ="detail_cw_info" id="cw_mail"> e-mail address </p>
							<p class ="detail_cw_info" id="cw_phone"> phone number </p>

						</div>
					</div>

					<script>

					var width = 600,
					height = 600,
					radius = Math.min(width, height);

					var radii = {
						"user" : radius / 12,
						"orbit_big" : radius / 2.5,
						"orbit_small" : radius / 4,
						"cw_tall" : radius / 25,
						"cw_grande" : radius / 20,
						"cw_venti" : radius / 15
					};

					var rect_size = {
						"big_width" : 96,
						"big_height" : 34,
						"small_width" : 74,
						"small_height" : 30
					};

					var cw_info = [
					{
						"priority" :1,
						"key":"xml",
						"qty":"12"
					},
					{
						"key":"합격",
						"qty":"25",
						"priority":2
					},{
						"key":"치킨",
						"qty":"100",
						"priority":1
					}
					];

					var user_info = [{
						"name" : "윤정훈",
						"link" : "/detail",
						"img_link" : "/윤정훈.png"
					}];


					var svg_around = d3.select("#svg_around")
					.attr("width", width)
					.attr("height", height)
					.append("g")
					.attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");


			// small orbit
			svg_around.append("circle")
			.attr("class", "smallOrbit")
			.attr("r", radii.orbit_small)
			.style("fill", "none")
			.style("stroke","gray")
			.style("stroke-dasharray", "5 5 5 5");


			// big orbit
			svg_around.append("circle")
			.attr("class", "bigOrbit")
			.attr("r", radii.orbit_big)
			.style("fill", "none")
			.style("stroke","gray")
			.style("stroke-dasharray", "5 5 5 5");


			// user circle

			var defs_user = svg_around.selectAll(".user_img")
			.data(user_info)
			.enter()
			.append("defs")
			.attr("id", "defs_u")
			.append("pattern")
			.attr("id", "catpattern_user")
			.attr("height", 20)
			.attr("width", 20)
			.attr("x", 0)
			.attr("y", 0)
			.append("image")
			.attr("x",  -20)
			.attr("y",  -10)
			.attr("height",150)
			.attr("width", 150)
			.attr("xlink:href", function (d){
				return d.img_link;
			});


			var user_circle = svg_around.selectAll(".user_circle")
			.data(user_info)
			.enter()
			.append("a")
			.attr("xlink:href", function(d) { return d.link; })
			.append("circle")
			.attr("r",radii.user)
			.style("fill", "url(#catpattern_user)");


			var grandeOrbitPosition = d3.svg.arc()
			.outerRadius(radii.orbit_small + 1)
			.innerRadius(radii.orbit_small - 1)
			.startAngle(0)
			.endAngle(0);
			
			svg_around.append("path")
			.attr("class", "grandeOrbitPosition")
			.attr("d", grandeOrbitPosition)
			.style("fill", "rgba(255, 204, 0, 0.75)");



			// coworker's keyword rectangle
			var cw_data = svg_around.selectAll(".co_workers")
			.data(cw_info)
			.enter();


			var default_small = [0,1,2,3,4,5,6,7]; 
			var default_big = [0,0.5,1,1.5,2,2.5,3,3.5,4,4.5,5,5.5,6,6.5,7];

			var pos_small = [];
			var pos_big = [];


			for(var k=0; k< cw_info.length; k++){
				var temp_small = Math.floor(Math.random() * (default_small.length));
				var temp_big =  Math.floor(Math.random() * (default_big.length));

				pos_small.push(default_small[temp_small]);
				pos_big.push(default_big[temp_big]);

				default_small.splice(temp_small,1);
				default_big.splice(temp_big,1);

				console.log(pos_big);
			}




			var cw_rects = cw_data
			.append("rect")
			.attr("width", function(d){
				return (d.priority == 1 ? rect_size.big_width : rect_size.small_width);
			})
			.attr("height", function(d){
				return (d.priority == 1 ? rect_size.big_height : rect_size.small_height);
			})			
			.attr("x", function (d,i) { 
				if(d.priority == 1){
					return (radii.orbit_small*Math.cos(pos_small[i]*45/180*3.1415926))- rect_size.big_width/2;}
					else{
						return (radii.orbit_big*Math.cos(pos_big[i]*45/180*3.1415926)) -rect_size.small_width/2;}
						;})
			.attr("y", function (d,i) { 
				if(d.priority == 1){
					return (radii.orbit_small*Math.sin(pos_small[i]*45/180*3.1415926)) - 14;}
					else {
						return (radii.orbit_big*Math.sin(pos_big[i]*45/180*3.1415926)) - 10;}
						;})	
			.style("fill", function(d){
				return (d.priority == 1 ? "#0066CC" : "#0099FF");
			});

			var cw_texts = cw_data.append("text")
			.attr("x", function (d,i) { 
				if(d.priority == 1){
					return (radii.orbit_small*Math.cos(pos_small[i]*45/180*3.1415926));}
					else{
						return (radii.orbit_big*Math.cos(pos_big[i]*45/180*3.1415926));}
						;})
			.attr("y", function (d,i) { 
				if(d.priority == 1){
					return ((radii.orbit_small*Math.sin(pos_small[i]*45/180*3.1415926)) - 14)+ rect_size.big_height/2 +3;}
					else {
						return ((radii.orbit_big*Math.sin(pos_big[i]*45/180*3.1415926)) -10 ) + rect_size.small_height/2 +2;}
						;})
			.text(function(d){
				return d.key + " (" + d.qty + ")";
			})
			.attr("fill","white")
			.style("text-anchor", "middle")
			.style("font-size", function(d){
				return (d.priority == 1 ? "16px" : "14px");
			});
			




			// get current date to show at noti.
			var today = new Date();
			var dd = today.getDate();
			var mm = today.getMonth()+1;
			var yyyy= today.getFullYear();
			var hours = today.getHours();
			var mins = today.getMinutes();
			var ampm = hours >= 12 ? "PM" : "AM";
			hours = hours % 12;
			hours = hours ? hours : 12;
			mins = mins < 10 ? '0'+mins : mins;

			var strTime = ampm + " " + hours + ":" + mins;
			document.getElementById("noti_time").innerHTML = strTime;

			if(dd<10)
				dd='0'+dd;
			if(mm<10)
				mm = '0'+mm;

			today = yyyy + '.' + mm + '.'+ dd;
			document.getElementById("noti_date").innerHTML = today;


			</script>


		</div>
		<div id="timeline2" style="display:none;">
			<div class="wrap" style="display:none;">

			</div>
		</div>

		<div id="timeline" style="background:#fff; display:none;">
			<div class="wrap" style="display:none;">
				<div class="calendar" style="padding: 5px; display:none">
				</div>
			</div>
		</div>
	</div>
	<script>
	$( document ).ready( function(){	
		$('#home_search_input').selectize({
			delimiter: ',',
			persist: false,
			create: function(input) {
				return {
					value: input,
					text: input
				}
			}
		});

		$.ajax({
			type:"POST",
			url: './mail/getMailCnt'
		}).done(function(data){
			var in_mail = data.sumMail;
			document.getElementById("in_num").innerHTML = in_mail;
			document.getElementById("msg_total_num").innerHTML = 3+3+in_mail;
			});

		$('#detail_close').click(function() {
   			 $('#cw_detail').toggle(); // or hide()
   			});

		//var queryString = new Array();
		$( document ).ready(function(){
			var qsParm = new Array();
			var query = window.location.search.substring(1);
			var parms = query.split('&');
			for (var i=0; i < parms.length; i++) {
				var pos = parms[i].indexOf('=');
				if (pos > 0) {
					var key = parms[i].substring(0, pos);
					var val = parms[i].substring(pos + 1);
					qsParm[key] = val;
					console.log(key +"=>"+ qsParm[key]);
				}
			}
			var decoded_name = decodeURIComponent(qsParm["name"]);
			document.getElementById("cw_name").innerHTML= decoded_name;


			var defs_cw_detail = d3.select("#detail_svg")
			.append("defs")
			.attr("id", "defs_u")
			.append("pattern")
			.attr("id", "catpattern_cw_detail")
			.attr("height", 20)
			.attr("width", 20)
			.attr("x", 0)
			.attr("y", 0)
			.append("image")
			.attr("x",  -15)
			.attr("y",  -10)
			.attr("height",150)
			.attr("width", 150)
			.attr("xlink:href", "/"+decoded_name+".png");


			var detail_circle = d3.select("#detail_svg")
			.append("circle")
			.attr("r", radii.user)
			.attr("cx",50)
			.attr("cy",50)
			.style("fill","url(#catpattern_cw_detail)");



		})

	});


</script>
</body>
</html>